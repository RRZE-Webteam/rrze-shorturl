(()=>{"use strict";const t=window.wp.i18n;jQuery(document).ready((function(e){var o=document.getElementById("shortened_url"),a=o?o.value:"https://www.fau.de";function r(t){const e=document.getElementById("shorturl-tooltip");e.textContent=t,e.style.display="inline-block",setTimeout((()=>{e.style.display="none"}),2e3)}new QRious({element:document.getElementById("qr"),value:a,size:200,background:"transparent",backgroundAlpha:0}),e("#customer-domains-form, #services-form").on("submit",(function(){if(e(this).find('input[type="checkbox"]:checked').length>0&&!confirm("WARNING! Are you sure you want to delete the selected entries? All Short URLs related to them will be deleted, too. This action cannot be undone."))return!1})),e("#show-advanced-settings").addClass("shorturl-link-disabled"),e("#url").on("input",(function(){""!==e(this).val().trim()?e("#show-advanced-settings").attr("href","#").removeClass("shorturl-link-disabled"):e("#show-advanced-settings").removeAttr("href").addClass("shorturl-link-disabled")})),e("#btn-show-advanced-settings").on("click",(function(t){t.preventDefault(),console.log("Button clicked"),e("#shorturl-advanced-settings").slideToggle(),console.log("Button class:",e(this).hasClass("active")),e(this).hasClass("active")?(console.log("active class"),e("span.arrow-up").removeClass("arrow-up").addClass("arrow-down"),e(this).attr("aria-expanded","false"),console.log("aria-expanded false")):(console.log("active not class"),e("span.arrow-down").removeClass("arrow-down").addClass("arrow-up"),console.log("class removed"),e(this).attr("aria-expanded","true"),console.log("aria-expanded true")),e(this).toggleClass("active"),console.log("class toggled to active"),console.log("Button class active:",e(this).hasClass("active"))})),e(document).on("mouseover",".shorturl-category-row",(function(){e(this).find(".shorturl-edit-category, .shorturl-delete-category").removeClass("hidden")})),e(document).on("mouseleave",".shorturl-category-row",(function(){e(this).find(".shorturl-edit-category, .shorturl-delete-category").addClass("hidden")})),e(document).on("click",".shorturl-edit-category",(function(t){t.preventDefault();var o=e(this).siblings(".shorturl-category-label").text().trim(),a=e(this).data("id");e(this).parent().html("<div class='shorturl-edit-container'><input type='text' class='shorturl-category-input' data-id='"+a+"' value='"+o+"'><button class='shorturl-update-category' data-id='"+a+"'>Update</button></div>")})),e(document).on("click",".shorturl-update-category",(function(){var t=e(this).data("id"),o=e(this).parent().find(".shorturl-category-input").val();e.ajax({url:rrze_shorturl_ajax_object.ajax_url,type:"POST",dataType:"json",data:{action:"update_category_label_action",category_id:t,updated_label:o,_ajax_nonce:rrze_shorturl_ajax_object.update_category_label_nonce},success:function(a){e("p").html(a.data),e(".shorturl-category-input[data-id='"+t+"']").parent().html("<span class='category-label'>"+o+"</span>")},error:function(t,e,o){console.error("THIS IS AN ERROR! "+t.responseText)}})})),e("#new-shorturl-category").slideToggle(),e("#add-new-shorturl-category").on("click",(function(t){t.preventDefault(),e("#new-shorturl-category").slideToggle()})),e(document).on("click","#add-shorturl-category-btn",(function(t){t.preventDefault();var o=e("input[name=new_shorturl_category]").val(),a=e("input[name=category_ids]").val();o?e.ajax({url:rrze_shorturl_ajax_object.ajax_url,type:"POST",data:{action:"add_shorturl_category",categoryName:o,parentCategory:e("select[name=parent_category]").val(),category_ids:a,_ajax_nonce:rrze_shorturl_ajax_object.add_shorturl_category_nonce},success:function(t){if(t.success){e("#shorturl-category-metabox").html(t.data.category_list_html);var o=t.data.category_id;e('input[name="shorturl_categories[]"][value="'+o+'"]').prop("checked",!0)}else alert("Failed to add category. Please try again.")}}):alert("Please enter a category name.")})),e(document).on("click",".edit-link",(function(t){t.preventDefault();var o=e(this).data("link-id"),a=window.location.href.split("?")[0]+"?link_id="+o+"#edit-link-form";window.location.href=a})),e(document).on("submit","#edit-link-form",(function(t){var o=e(".notice.is-dismissible").data("error");if(!1===o||"false"===o){var a=window.location.href.split("?")[0];window.history.pushState({},document.title,a)}})),e(document).on("click",".delete-link",(function(t){t.preventDefault();var o=e(this).data("link-id");confirm("Are you sure you want to delete this link?")&&e.ajax({url:rrze_shorturl_ajax_object.ajax_url,method:"POST",data:{action:"delete_link",link_id:o,_ajax_nonce:rrze_shorturl_ajax_object.delete_shorturl_link_nonce},success:function(t){window.location.hash&&history.replaceState(null,null,window.location.href.split("#")[0]),location.reload()},error:function(t,e,o){console.error("Error deleting link:",o)}})})),e(document).on("change",".allow-uri-checkbox, .allow-get-checkbox, .allow-utm-checkbox",(function(){var t,o=e(this).data("id");t=e(this).hasClass("allow-uri-checkbox")?"allow_uri":e(this).hasClass("allow-utm-checkbox")?"allow_utm":"allow_get";var a=e(this).prop("checked")?"true":"false";e.ajax({url:rrze_shorturl_ajax_object.ajax_url,type:"POST",data:{action:"update_idm",id:o,field:t,value:a,_ajax_nonce:rrze_shorturl_ajax_object.update_shorturl_idm_nonce},success:function(t){location.reload()},error:function(t,e,o){console.error("Error updating field:",o)}})})),e(document).on("click","#copyButton",(function(o){return o.preventDefault(),function(e){if(e)if(navigator.clipboard)navigator.clipboard.writeText(e).then((()=>{r((0,t.__)("URL copied!","rrze-shorturl"))})).catch((t=>{console.error("Copy failed:",t)}));else{const o=document.createElement("textarea");o.value=e,o.style.position="fixed",document.body.appendChild(o),o.select();try{document.execCommand("copy"),r((0,t.__)("URL copied!","rrze-shorturl"))}catch(t){console.error("Copy failed:",t)}finally{document.body.removeChild(o)}}}(e(this).data("shortened-url")),o.stopPropagation(),!1})),e(document).on("click","#downloadButton",(function(t){t.preventDefault();var e=document.getElementById("qr"),o=document.createElement("a");return o.href=e.toDataURL("image/png"),o.download="qr-code.png",document.body.appendChild(o),o.click(),document.body.removeChild(o),t.stopPropagation(),!1})),e("table.shorturl-categories tbody").on("mouseover","td.category-label",(function(){e(this).find(".edit-link").length||e(this).append('<a href="#" class="edit-link">Edit</a>')})),e("table.shorturl-categories tbody").on("mouseout","td.category-label",(function(t){var o=e(this).find(".edit-link");o.is(":hover")||o.hasClass("editing")||o.remove()})),e("table.shorturl-categories tbody").on("click",".edit-link",(function(t){t.preventDefault(),t.stopPropagation(),e(this).hide();var o=e(this).closest("td").find("span"),a=o.text().trim();o.html('<input type="text" class="category-input">').find(".category-input").val(a),e(".category-input").focus().select(),e(this).addClass("editing")})),e("table.shorturl-categories tbody").on("blur",".category-input",(function(){var t=e(this).val().trim(),o=e(this).closest("td").data("id"),a=e(this).parent().find(".edit-link");e.ajax({url:rrze_shorturl_ajax_object.ajax_url,type:"POST",data:{action:"update_shorturl_category_label",category_id:o,updated_label:t,_ajax_nonce:rrze_shorturl_ajax_object.update_category_label_nonce},success:function(o){var r=e("<span>").text(t);e(this).parent().empty().append(r),a.show()}.bind(this)})})),e(document).on("click",".delete-category",(function(t){t.preventDefault();var o=e(this).data("category-id");confirm("Are you sure you want to delete this category?")&&e.ajax({url:rrze_shorturl_ajax_object.ajax_url,method:"POST",data:{action:"delete_category",category_id:o,_ajax_nonce:rrze_shorturl_ajax_object.delete_shorturl_category_nonce},success:function(t){var e=window.location.href;e=e.split("?")[0],window.location.href=e},error:function(t,e,o){console.error("Error deleting category:",o)}})})),e(document).on("click",".edit-category-button",(function(){var t=e(this).data("category-id");e(".edit-category-form[data-category-id="+t+"]").toggle(),e(".shorturl-wp-list-table").hide()}))}))})();